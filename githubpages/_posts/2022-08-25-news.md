---
title: JekyllからAPIを叩く
description: JekyllからAPIを呼び出す方法(GitHub Pagesの自動ビルドにも対応する)
---

## NEWS APIとは
NEWS APIは、世界中のNEWSをかき集めてくれる便利なAPI. 登録が必要だが、無料で利用できる.  

## インストール
[ここ](https://newsapi.org/docs/get-started)のインストールガイドを参考に導入する.  

## ヘッドラインをJSONで保存する

NEWS APIは取得したデータをJSON形式で返す.  
Jekyllでは、`_data`フォルダに保存されたJSONデータはサイト内で使用できるため、JSONファイルを`_data`フォルダに保存するプラグインを記述する.  


_plugins/news-api.rb
```ruby
require 'open-uri'
require 'json'

url = "https://newsapi.org/v2/top-headlines?country=jp&apiKey=<YOUR API KEY>"
req = open(url)
response_body = req.read

File.open("_data/news.json", "w") do |f|
  f.write response_body
end

```


## NEWSをブログポストページに表示する
NEWS APIのヘッドラインはデフォルトで30件を取得するようなので、
そのうち5件を表示するように、liquidのイテレーション内で`limit: 5`を指定している.  

{% raw %}

_includes/news.html
```html
  <div class="news">
    <div class="news-title">
      <h3>Today's NEWS</h3>
    </div>
  {% for article in site.data.news.articles limit: 5 %}
    <p>
      {{ article.title }}
      <a href="{{ article.url }}">
        {{ article.url }}
      </a>
      <img src="{{ article.urlToImage }}" alt="" style="height:150px;">
    </p>
  {% endfor %}
</div>
```
{% endraw %}

デザインは整えていないので、こんな感じの雑な表示だが、とりあえず実装できた.  
![](/images/githubpages/posts/2022-08-25-news/image1.png)


